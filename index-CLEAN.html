<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Nebula Finance - Tu administrador financiero personal con tecnolog√≠a gal√°ctica">
    <meta name="theme-color" content="#1a1a2e">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Nebula Finance">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <title>üåå Nebula Finance - Administrador Financiero</title>
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"></noscript>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    },
                    colors: {
                        'nebula': {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e'
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Crypto.js for Security (loaded before our security module) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    
    <style>
        /* Critical CSS - Pantalla de carga */
        #nebula-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f23, #16213e, #1a1a2e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: #fbbf24;
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        .loading-spinner {
            border: 4px solid rgba(251, 191, 36, 0.3);
            border-left: 4px solid #fbbf24;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Fondo espacial */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0f0f23, #16213e, #1a1a2e);
            min-height: 100vh;
            font-family: 'Inter', system-ui, sans-serif;
            overflow-x: hidden;
        }
        
        /* Estrellas de fondo */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle 4s linear infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Efectos cuando la app est√° cargada */
        .nebula-loaded {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="dark bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900">
    <!-- Pantalla de carga inicial -->
    <div id="nebula-loading">
        <div class="loading-spinner"></div>
        <h2 class="text-2xl font-bold mb-2">üåå Nebula Finance</h2>
        <p class="text-lg opacity-80">Iniciando sistemas gal√°cticos...</p>
        <div class="mt-4 text-sm opacity-60">
            <div id="loading-progress">Cargando m√≥dulos...</div>
        </div>
    </div>
    
    <!-- Fondo de estrellas -->
    <div class="stars" id="stars"></div>
    
    <!-- Contenedor principal de la aplicaci√≥n -->
    <div id="app-container" class="relative min-h-screen">
        <!-- Contenido principal -->
        <div id="content-root" class="relative z-10 pb-24">
            <!-- El contenido se cargar√° aqu√≠ din√°micamente -->
        </div>
        
        <!-- Dock/navegaci√≥n inferior -->
        <div id="dock-root" class="fixed bottom-0 left-0 right-0 z-20">
            <!-- La navegaci√≥n se cargar√° aqu√≠ din√°micamente -->
        </div>
        
        <!-- Modal root -->
        <div id="modal-root" class="fixed inset-0 z-50 pointer-events-none">
            <!-- Los modales se cargar√°n aqu√≠ din√°micamente -->
        </div>
        
        <!-- Fondo paralaje -->
        <div id="parallax-bg" class="fixed inset-0 z-0">
            <!-- Efectos de paralaje se cargar√°n aqu√≠ -->
        </div>
    </div>

    <script>
        // üåü Variables globales iniciales
        window.nebulaStarted = false;
        
        // üé® Crear estrellas de fondo
        function createStars() {
            const starsContainer = document.getElementById('stars');
            if (!starsContainer) return;
            
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.animationDelay = Math.random() * 4 + 's';
                starsContainer.appendChild(star);
            }
        }
        
        // üöÄ Funci√≥n principal de inicializaci√≥n (SIMPLIFICADA)
        const initNebulaApp = () => {
            try {
                console.log('üåå Iniciando Nebula Finance...');
                
                // Prevenir m√∫ltiples inicializaciones
                if (window.nebulaStarted) {
                    console.log('‚úã Aplicaci√≥n ya iniciada');
                    return;
                }
                
                // Verificar DOM
                const contentRoot = document.getElementById('content-root');
                const dockRoot = document.getElementById('dock-root');
                
                if (!contentRoot || !dockRoot) {
                    console.error('‚ùå Elementos DOM cr√≠ticos no encontrados');
                    return;
                }
                
                // Marcar como iniciado
                window.nebulaStarted = true;
                
                // Ocultar pantalla de carga
                const loading = document.getElementById('nebula-loading');
                if (loading) {
                    loading.style.display = 'none';
                }
                
                // Mostrar interfaz principal
                contentRoot.innerHTML = `
                    <div class="container mx-auto px-4 py-8">
                        <header class="text-center mb-12">
                            <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-amber-400 to-amber-600 bg-clip-text text-transparent">
                                üåå Nebula Finance
                            </h1>
                            <p class="text-xl text-amber-200 mb-2">Tu administrador financiero personal</p>
                            <p class="text-gray-400">Versi√≥n estable - Modo b√°sico activo</p>
                        </header>
                        
                        <main class="max-w-6xl mx-auto">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                                <div class="bg-black/20 backdrop-blur-md border border-amber-200/30 rounded-xl p-6 hover:border-amber-300/50 transition-all duration-300 hover:scale-105">
                                    <div class="text-4xl mb-4 text-center">üí∞</div>
                                    <h3 class="text-xl font-semibold mb-3 text-amber-300">Ingresos</h3>
                                    <p class="text-gray-300 mb-4">Registra y gestiona todos tus ingresos de forma inteligente</p>
                                    <button class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                        Gestionar Ingresos
                                    </button>
                                </div>
                                
                                <div class="bg-black/20 backdrop-blur-md border border-amber-200/30 rounded-xl p-6 hover:border-amber-300/50 transition-all duration-300 hover:scale-105">
                                    <div class="text-4xl mb-4 text-center">üí∏</div>
                                    <h3 class="text-xl font-semibold mb-3 text-amber-300">Gastos</h3>
                                    <p class="text-gray-300 mb-4">Controla y analiza tus gastos con precisi√≥n gal√°ctica</p>
                                    <button class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                        Controlar Gastos
                                    </button>
                                </div>
                                
                                <div class="bg-black/20 backdrop-blur-md border border-amber-200/30 rounded-xl p-6 hover:border-amber-300/50 transition-all duration-300 hover:scale-105">
                                    <div class="text-4xl mb-4 text-center">üéØ</div>
                                    <h3 class="text-xl font-semibold mb-3 text-amber-300">Metas</h3>
                                    <p class="text-gray-300 mb-4">Planifica tu futuro financiero como un verdadero estratega</p>
                                    <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                        Planificar Metas
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-black/20 backdrop-blur-md border border-amber-200/30 rounded-xl p-6 mb-8">
                                <h3 class="text-xl font-semibold mb-4 text-amber-300">üìä Resumen Financiero</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-green-400">$0.00</div>
                                        <div class="text-sm text-gray-400">Ingresos del mes</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-red-400">$0.00</div>
                                        <div class="text-sm text-gray-400">Gastos del mes</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-amber-400">$0.00</div>
                                        <div class="text-sm text-gray-400">Balance actual</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center space-x-4">
                                <button onclick="location.reload()" class="bg-amber-500 hover:bg-amber-600 text-black px-6 py-3 rounded-lg font-semibold transition-colors">
                                    üîÑ Recargar Aplicaci√≥n
                                </button>
                                <a href="direct-access.html" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold inline-block transition-colors">
                                    üõ†Ô∏è Herramientas de Diagn√≥stico
                                </a>
                                <a href="diagnostic.html" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold inline-block transition-colors">
                                    üîç Estado del Sistema
                                </a>
                            </div>
                        </main>
                    </div>
                `;
                
                // Mostrar dock b√°sico
                dockRoot.innerHTML = `
                    <div class="bg-black/40 backdrop-blur-md border-t border-amber-200/20 px-4 py-2">
                        <div class="flex justify-center space-x-6">
                            <button class="flex flex-col items-center text-amber-300 hover:text-amber-200 transition-colors p-2">
                                <div class="text-xl mb-1">üè†</div>
                                <span class="text-xs">Inicio</span>
                            </button>
                            <button class="flex flex-col items-center text-gray-400 hover:text-amber-200 transition-colors p-2">
                                <div class="text-xl mb-1">üí∞</div>
                                <span class="text-xs">Ingresos</span>
                            </button>
                            <button class="flex flex-col items-center text-gray-400 hover:text-amber-200 transition-colors p-2">
                                <div class="text-xl mb-1">üí∏</div>
                                <span class="text-xs">Gastos</span>
                            </button>
                            <button class="flex flex-col items-center text-gray-400 hover:text-amber-200 transition-colors p-2">
                                <div class="text-xl mb-1">üìä</div>
                                <span class="text-xs">Reportes</span>
                            </button>
                            <button class="flex flex-col items-center text-gray-400 hover:text-amber-200 transition-colors p-2">
                                <div class="text-xl mb-1">‚öôÔ∏è</div>
                                <span class="text-xs">Config</span>
                            </button>
                        </div>
                    </div>
                `;
                
                // Efectos visuales
                document.body.classList.add('nebula-loaded');
                createStars();
                
                console.log('‚úÖ Nebula Finance iniciado exitosamente');
                
            } catch (error) {
                console.error('‚ùå Error cr√≠tico en inicializaci√≥n:', error);
                
                // Fallback de emergencia
                const loading = document.getElementById('nebula-loading');
                if (loading) {
                    loading.innerHTML = `
                        <div class="text-center">
                            <div class="text-4xl mb-4">‚ö†Ô∏è</div>
                            <h2 class="text-2xl font-bold mb-4">Error de Inicializaci√≥n</h2>
                            <p class="mb-4">No se pudo iniciar la aplicaci√≥n correctamente</p>
                            <button onclick="location.reload()" class="bg-amber-500 text-black px-6 py-3 rounded-lg font-semibold">
                                üîÑ Reintentar
                            </button>
                        </div>
                    `;
                }
            }
        };
        
        // üéØ Inicializar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initNebulaApp);
        } else {
            initNebulaApp();
        }
        
        // üö® Timeout de seguridad - Forzar inicializaci√≥n despu√©s de 3 segundos
        setTimeout(() => {
            if (!window.nebulaStarted) {
                console.log('üö® Timeout de seguridad - Forzando inicializaci√≥n...');
                initNebulaApp();
            }
        }, 3000);
        
        // üîí Funciones de utilidad
        window.sanitizeHTML = function(str) {
            if (typeof str !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        };
        
        // üì± Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('üîß SW registrado'))
                    .catch(error => console.log('‚ùå SW error:', error));
            });
        }
    </script>
</body>
</html>
