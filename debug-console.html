<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Debug Console - Sistema Nebula</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .debug-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #10b981;
        }
        
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-ok { background: #10b981; }
        .status-warning { background: #f59e0b; }
        .status-error { background: #ef4444; }
        
        .check-button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .check-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .system-info {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 15px;
        }
        
        .error-info {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 15px;
        }
        
        .link-app {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 600;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .link-app:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Debug Console - Sistema Nebula</h1>
            <p>Herramienta de diagnÃ³stico para verificar el estado del sistema</p>
        </div>

        <!-- Panel de Estado General -->
        <div class="debug-section">
            <h2>ğŸ“Š Estado General del Sistema</h2>
            <div id="system-status">
                <p>Iniciando verificaciÃ³n...</p>
            </div>
            <button class="check-button" onclick="checkSystemStatus()">ğŸ”„ Verificar Estado</button>
        </div>

        <!-- Panel de Errores -->
        <div class="debug-section">
            <h2>ğŸš¨ Monitor de Errores</h2>
            <div class="console-output" id="error-console">
                <!-- Los errores aparecerÃ¡n aquÃ­ -->
            </div>
            <button class="check-button" onclick="clearErrorConsole()">ğŸ—‘ï¸ Limpiar</button>
            <button class="check-button" onclick="startErrorMonitoring()">â–¶ï¸ Iniciar Monitoreo</button>
        </div>

        <!-- Panel de Verificaciones -->
        <div class="grid">
            <div class="debug-section">
                <h3>ğŸ” AutenticaciÃ³n</h3>
                <div id="auth-status">No verificado</div>
                <button class="check-button" onclick="checkAuthentication()">Verificar Auth</button>
            </div>

            <div class="debug-section">
                <h3>ğŸ“… Calendario</h3>
                <div id="calendar-status">No verificado</div>
                <button class="check-button" onclick="checkCalendar()">Verificar Calendar</button>
            </div>

            <div class="debug-section">
                <h3>ğŸ”¥ Firebase</h3>
                <div id="firebase-status">No verificado</div>
                <button class="check-button" onclick="checkFirebase()">Verificar Firebase</button>
            </div>

            <div class="debug-section">
                <h3>ğŸ’¾ Almacenamiento</h3>
                <div id="storage-status">No verificado</div>
                <button class="check-button" onclick="checkStorage()">Verificar Storage</button>
            </div>
        </div>

        <!-- Enlaces RÃ¡pidos -->
        <div class="debug-section">
            <h2>ğŸ”— Enlaces RÃ¡pidos</h2>
            <a href="index-LAB.html" class="link-app">ğŸŒŒ Abrir App Principal</a>
            <a href="test-sistema-auth.html" class="link-app">ğŸ§ª Panel de Pruebas</a>
        </div>

        <!-- InformaciÃ³n del Sistema -->
        <div class="debug-section">
            <h2>â„¹ï¸ InformaciÃ³n del Sistema</h2>
            <div class="system-info" id="system-info">
                Cargando informaciÃ³n...
            </div>
        </div>
    </div>

    <script>
        let errorLog = [];
        let isMonitoring = false;

        // Capturar errores globalmente
        window.addEventListener('error', (event) => {
            logError(`ERROR: ${event.message} en ${event.filename}:${event.lineno}`);
        });

        window.addEventListener('unhandledrejection', (event) => {
            logError(`PROMISE REJECTED: ${event.reason}`);
        });

        function logError(message) {
            const timestamp = new Date().toISOString().substring(11, 23);
            errorLog.push(`[${timestamp}] ${message}`);
            
            if (isMonitoring) {
                updateErrorConsole();
            }
        }

        function updateErrorConsole() {
            const console = document.getElementById('error-console');
            console.innerHTML = errorLog.length > 0 
                ? errorLog.slice(-20).join('\n')
                : 'Sin errores detectados';
            console.scrollTop = console.scrollHeight;
        }

        function clearErrorConsole() {
            errorLog = [];
            updateErrorConsole();
        }

        function startErrorMonitoring() {
            isMonitoring = true;
            updateErrorConsole();
            logError('MONITOREO: Iniciado correctamente');
        }

        // VerificaciÃ³n del estado general
        function checkSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            let status = '';

            // Verificar elementos crÃ­ticos
            const checks = [
                { name: 'localStorage', test: () => typeof(Storage) !== "undefined" },
                { name: 'fetch API', test: () => typeof fetch !== "undefined" },
                { name: 'Promises', test: () => typeof Promise !== "undefined" },
                { name: 'ES6 Classes', test: () => { try { new class {}; return true; } catch { return false; } }},
                { name: 'Console', test: () => typeof console !== "undefined" }
            ];

            checks.forEach(check => {
                const result = check.test();
                const indicator = result ? 'status-ok' : 'status-error';
                const emoji = result ? 'âœ…' : 'âŒ';
                status += `<div><span class="status-indicator ${indicator}"></span>${emoji} ${check.name}</div>`;
            });

            statusDiv.innerHTML = status;
        }

        // Verificar autenticaciÃ³n
        function checkAuthentication() {
            const statusDiv = document.getElementById('auth-status');
            let status = '';

            if (typeof NebulaAuth !== 'undefined') {
                status += '<span class="status-indicator status-ok"></span>âœ… NebulaAuth disponible<br>';
            } else {
                status += '<span class="status-indicator status-error"></span>âŒ NebulaAuth no encontrado<br>';
            }

            if (typeof NebulaAuthUI !== 'undefined') {
                status += '<span class="status-indicator status-ok"></span>âœ… NebulaAuthUI disponible<br>';
            } else {
                status += '<span class="status-indicator status-error"></span>âŒ NebulaAuthUI no encontrado<br>';
            }

            statusDiv.innerHTML = status;
        }

        // Verificar calendario
        function checkCalendar() {
            const statusDiv = document.getElementById('calendar-status');
            
            // Intentar abrir app en iframe para verificar calendario
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'index-LAB.html';
            iframe.onload = () => {
                try {
                    const iframeWindow = iframe.contentWindow;
                    const hasCalendar = iframeWindow.document.querySelector('[data-calendar]') !== null;
                    statusDiv.innerHTML = hasCalendar 
                        ? '<span class="status-indicator status-ok"></span>âœ… Calendario detectado'
                        : '<span class="status-indicator status-warning"></span>âš ï¸ Calendario no detectado';
                } catch (e) {
                    statusDiv.innerHTML = '<span class="status-indicator status-error"></span>âŒ Error verificando calendario';
                }
                document.body.removeChild(iframe);
            };
            document.body.appendChild(iframe);
        }

        // Verificar Firebase
        function checkFirebase() {
            const statusDiv = document.getElementById('firebase-status');
            
            fetch('.env')
                .then(response => response.ok 
                    ? '<span class="status-indicator status-ok"></span>âœ… Archivo .env disponible'
                    : '<span class="status-indicator status-warning"></span>âš ï¸ Archivo .env no encontrado'
                )
                .catch(() => '<span class="status-indicator status-error"></span>âŒ Error accediendo .env')
                .then(result => {
                    statusDiv.innerHTML = result;
                });
        }

        // Verificar almacenamiento
        function checkStorage() {
            const statusDiv = document.getElementById('storage-status');
            let status = '';

            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                status += '<span class="status-indicator status-ok"></span>âœ… localStorage funcionando<br>';
            } catch (e) {
                status += '<span class="status-indicator status-error"></span>âŒ localStorage no disponible<br>';
            }

            try {
                sessionStorage.setItem('test', 'test');
                sessionStorage.removeItem('test');
                status += '<span class="status-indicator status-ok"></span>âœ… sessionStorage funcionando<br>';
            } catch (e) {
                status += '<span class="status-indicator status-error"></span>âŒ sessionStorage no disponible<br>';
            }

            statusDiv.innerHTML = status;
        }

        // Cargar informaciÃ³n del sistema
        function loadSystemInfo() {
            const infoDiv = document.getElementById('system-info');
            
            const info = `
                <strong>ğŸŒ Navegador:</strong> ${navigator.userAgent}<br>
                <strong>ğŸ“ URL:</strong> ${window.location.href}<br>
                <strong>ğŸ• Timestamp:</strong> ${new Date().toISOString()}<br>
                <strong>ğŸ”§ Cookies:</strong> ${navigator.cookieEnabled ? 'Habilitadas' : 'Deshabilitadas'}<br>
                <strong>ğŸ“± Online:</strong> ${navigator.onLine ? 'SÃ­' : 'No'}<br>
                <strong>ğŸ¨ ResoluciÃ³n:</strong> ${screen.width}x${screen.height}<br>
                <strong>ğŸ’¾ Memoria:</strong> ${navigator.deviceMemory || 'No disponible'} GB<br>
                <strong>ğŸ”Œ ConexiÃ³n:</strong> ${navigator.connection?.effectiveType || 'Desconocida'}
            `;
            
            infoDiv.innerHTML = info;
        }

        // Inicializar al cargar
        window.addEventListener('load', () => {
            loadSystemInfo();
            checkSystemStatus();
            startErrorMonitoring();
            console.log('ğŸ” Debug Console cargado - Listo para diagnÃ³sticos');
        });

        // Auto-refresh cada 30 segundos
        setInterval(() => {
            if (isMonitoring) {
                checkSystemStatus();
            }
        }, 30000);
    </script>
</body>
</html>
