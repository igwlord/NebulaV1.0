<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Registro - Nebula Financial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .auth-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .auth-form { min-height: 300px; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
    <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md">
        <h1 class="text-2xl font-bold mb-6 text-center">Test Formulario de Registro</h1>
        
        <!-- Tabs -->
        <div class="flex mb-6 bg-gray-700 rounded-lg p-1">
            <button id="login-tab" class="auth-tab flex-1 py-2 px-4 rounded text-sm font-medium transition-all active">
                Iniciar Sesi√≥n
            </button>
            <button id="register-tab" class="auth-tab flex-1 py-2 px-4 rounded text-sm font-medium transition-all">
                Registrarse
            </button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="auth-form space-y-4">
            <div>
                <label for="login-email" class="block text-sm font-medium mb-2">Email</label>
                <input type="email" id="login-email" required class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
            </div>
            <div>
                <label for="login-password" class="block text-sm font-medium mb-2">Contrase√±a</label>
                <input type="password" id="login-password" required class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
            </div>
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded font-medium transition-colors">
                Iniciar Sesi√≥n
            </button>
            <button type="button" id="forgot-password-btn" class="w-full text-blue-400 hover:text-blue-300 text-sm">
                ¬øOlvidaste tu contrase√±a?
            </button>
        </form>

        <!-- Register Form -->
        <form id="register-form" class="auth-form space-y-4 hidden">
            <div>
                <label for="register-name" class="block text-sm font-medium mb-2">Nombre completo</label>
                <input type="text" id="register-name" required class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
            </div>
            <div>
                <label for="register-email" class="block text-sm font-medium mb-2">Email</label>
                <input type="email" id="register-email" required class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
            </div>
            <div>
                <label for="register-password" class="block text-sm font-medium mb-2">Contrase√±a</label>
                <input type="password" id="register-password" required minlength="6" class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
            </div>
            <div>
                <label for="register-confirm-password" class="block text-sm font-medium mb-2">Confirmar contrase√±a</label>
                <input type="password" id="register-confirm-password" required minlength="6" class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
            </div>
            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 py-3 rounded font-medium transition-colors">
                Crear Cuenta
            </button>
        </form>

        <!-- Email Verification Notice -->
        <div id="email-verification-notice" class="hidden mt-4 p-4 bg-yellow-900 border border-yellow-600 rounded">
            <h4 class="font-medium mb-2">üìß Verifica tu email</h4>
            <p class="text-sm text-yellow-200 mb-3">
                Hemos enviado un enlace de verificaci√≥n a tu email. Por favor revisa tu bandeja de entrada y haz clic en el enlace para activar tu cuenta.
            </p>
            <button id="resend-verification" class="text-yellow-400 hover:text-yellow-300 text-sm underline">
                Reenviar email de verificaci√≥n
            </button>
        </div>

        <!-- Test Status -->
        <div id="test-status" class="mt-6 p-4 bg-gray-700 rounded">
            <h4 class="font-medium mb-2">üß™ Estado del Test</h4>
            <div id="status-log" class="text-sm space-y-1"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./config/firebase-config.js"></script>
    <script src="./js/auth/firebase-auth.js"></script>
    
    <script>
        // Test Logger
        function logTest(message, type = 'info') {
            const log = document.getElementById('status-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            log.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // Mock notification system
        window.showNotification = function(message, type = 'info') {
            logTest(`Notification (${type}): ${message}`, type);
            alert(`${type.toUpperCase()}: ${message}`);
        };

        // Mock appState
        window.appState = {
            user: null,
            setUser: function(user) {
                this.user = user;
                logTest(`Usuario establecido: ${user ? user.email : 'null'}`, 'success');
            }
        };

        // Initialize Firebase and setup listeners
        async function initTest() {
            try {
                logTest('üî• Inicializando Firebase para test...', 'info');
                
                // Wait for Firebase config
                if (typeof NebulaConfig === 'undefined') {
                    logTest('‚è≥ Esperando configuraci√≥n de Firebase...', 'warning');
                    setTimeout(initTest, 100);
                    return;
                }
                
                logTest('‚úÖ Firebase config disponible', 'success');
                
                // Wait for NebulaAuth
                if (typeof NebulaAuth === 'undefined') {
                    logTest('‚è≥ Esperando NebulaAuth...', 'warning');
                    setTimeout(initTest, 100);
                    return;
                }
                
                logTest('‚úÖ NebulaAuth disponible', 'success');
                
                // Setup tab switching
                setupTabSwitching();
                
                // Setup form listeners
                setupFormListeners();
                
                logTest('üéØ Test inicializado correctamente', 'success');
                
            } catch (error) {
                logTest(`‚ùå Error inicializando test: ${error.message}`, 'error');
            }
        }

        function setupTabSwitching() {
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            logTest('üîÑ Configurando tabs...', 'info');
            
            loginTab.addEventListener('click', () => {
                logTest('üìã Cambiando a tab de login', 'info');
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            });
            
            registerTab.addEventListener('click', () => {
                logTest('üìã Cambiando a tab de registro', 'info');
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            });
        }

        function setupFormListeners() {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            logTest('üìù Configurando formularios...', 'info');
            
            // Login form
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                logTest('üîë Intento de login...', 'info');
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                try {
                    await NebulaAuth.signInWithEmail(email, password);
                    logTest('‚úÖ Login exitoso', 'success');
                } catch (error) {
                    logTest(`‚ùå Error en login: ${error.message}`, 'error');
                }
            });
            
            // Register form
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                logTest('üìù Intento de registro...', 'info');
                
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                // Validations
                if (password !== confirmPassword) {
                    logTest('‚ùå Las contrase√±as no coinciden', 'error');
                    showNotification('Las contrase√±as no coinciden', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    logTest('‚ùå Contrase√±a muy corta', 'error');
                    showNotification('La contrase√±a debe tener al menos 6 caracteres', 'error');
                    return;
                }
                
                try {
                    await NebulaAuth.createUserWithEmail(email, password, name);
                    logTest('‚úÖ Registro exitoso - mostrar aviso de verificaci√≥n', 'success');
                    
                    // Show verification notice
                    document.getElementById('email-verification-notice').classList.remove('hidden');
                    
                } catch (error) {
                    logTest(`‚ùå Error en registro: ${error.message}`, 'error');
                }
            });
            
            // Forgot password
            document.getElementById('forgot-password-btn').addEventListener('click', async () => {
                const email = document.getElementById('login-email').value;
                if (!email) {
                    logTest('‚ö†Ô∏è Email requerido para reset', 'warning');
                    showNotification('Ingresa tu email primero', 'warning');
                    return;
                }
                
                try {
                    await NebulaAuth.resetPassword(email);
                    logTest('‚úÖ Email de reset enviado', 'success');
                } catch (error) {
                    logTest(`‚ùå Error en reset: ${error.message}`, 'error');
                }
            });
            
            // Resend verification
            document.getElementById('resend-verification').addEventListener('click', async () => {
                try {
                    await NebulaAuth.resendEmailVerification();
                    logTest('‚úÖ Email de verificaci√≥n reenviado', 'success');
                } catch (error) {
                    logTest(`‚ùå Error reenviando verificaci√≥n: ${error.message}`, 'error');
                }
            });
        }

        // Start test when page loads
        document.addEventListener('DOMContentLoaded', initTest);
        
        logTest('üöÄ Test page cargada', 'info');
    </script>
</body>
</html>
